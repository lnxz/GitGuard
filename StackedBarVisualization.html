<html>
	<style>
		.axis text {
			font: 14px sans-serif;
		}

		.axis line,
		.axis path {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}

		.axis--x path {
			display: none;
		}

		svg {
			border: solid 1px #ccc;
			font: 10px sans-serif;
			shape-rendering: crispEdges;
		}
	</style>
	<head>
		<title> Top 10 Addition/Deletions </title>
		<script src="./javascripts/d3.min.js"></script>
	</head>
	<body>
		<div align="left">
			<h1> Top 10 contributions to project (additions/deletions) </h1>
			<div id="chart">
			</div>
		</div>
		<div id="viz"></div>
		<script>


			//Retrieve JSON data
			var url = "https://api.github.com/repos/tungnk1993/scrapy/stats/contributors";
			d3.json(url, function(response) {
				var authorArray = new Array(response.length).fill(0);
				var addArray = new Array(response.length).fill(0);
				var delArray = new Array(response.length).fill(0);
				var combineArray = new Array(response.length).fill(0);

				// Placeholder for user array
				var usersArray = new Array(response.length).fill(0);

				for (var i = 0; i < response.length; i++) {
					var item = response[i];

					authorArray[i] = item.author.login;

					// Placeholder for selecting users
					if(i < 5){
						usersArray[i] =item.author.login;
					}

					var weeks = item.weeks.length;
					var adds = 0;
					var dels = 0;

					var weeksData = new Array(weeks).fill(0);
					weeksData = item.weeks;

					for (var x = 0; x <= weeks - 1; x++) {
						var weekItem = weeksData[x];
						addArray[i] += weekItem.a;
						delArray[i] += weekItem.d;
					};
				};

				for (var y = 0; y <= response.length; y++) {
					combineArray[y] = addArray[y] + delArray[y]
				};

				var dataArr = [];
				for (var i = 0; i < response.length; i++) {
					var obj = {
						name: authorArray[i],
						additions: addArray[i],
						deletions: delArray[i],
						total: combineArray[i]
					};
					dataArr.push(obj);
				}

				dataArr.sort(function(a, b) {
					return b.total - a.total;
				});

				var topData = [];



				for (var i =0; i < response.length; i ++)
				{
					for (var j = 0; j < usersArray.length; j ++ )
					{
							if(authorArray[i] == usersArray[j])
							{
								topData.push(dataArr[i]);
							}
					}
				}
				console.log(authorArray);
				console.log(usersArray);
				/*
				if (response.length > 9) {
					for (var i = 0; i < 10; i++) {
						topData.push(dataArr[i]);
					}
				} else {
					for (var i = 0; i < response.length; i++) {
						topData.push(dataArr[i]);
					}
				}
				*/

				var margin = {
						top: 20,
						right: 80,
						bottom: 30,
						left: 20
					},
					width = 1400 - margin.left - margin.right,
					height = 500 - margin.top - margin.bottom;

				var x = d3.scale.ordinal()
					.rangeRoundBands([0, width]);

				var y = d3.scale.linear()
					.rangeRound([height, 0]);

				var z = d3.scale.ordinal().range(["#f64e4e", "#a8d6aa"])

				var xAxis = d3.svg.axis()
					.scale(x)
					.orient("bottom")

				var yAxis = d3.svg.axis()
					.scale(y)
					.orient("right");

				var svg = d3.select("body").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
					.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


				var layers = d3.layout.stack()(["additions", "deletions"].map(function(c) {
					return topData.map(function(d) {
						return {
							x: d.name,
							y: d[c]
						};
					});
				}));

				x.domain(layers[0].map(function(d) {
					return d.x;
				}));
				y.domain([0, d3.max(layers[layers.length - 1], function(d) {
					return d.y0 + d.y;
				})]).nice();


				var layer = svg.selectAll(".layer")
					.data(layers)
					.enter().append("g")
					.attr("class", "layer")
					.style("fill", function(d, i) {
						return z(i);
					});

				layer.selectAll("rect")
					.data(function(d) {
						return d;
					})
					.enter().append("rect")
					.attr("x", function(d) {
						return x(d.x);
					})
					.attr("y", function(d) {
						return y(d.y + d.y0);
					})
					.attr("height", function(d) {
						return y(d.y0) - y(d.y + d.y0);
					})
					.attr("width", x.rangeBand() - 1);


				svg.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + height + ")")
					.call(xAxis);

				svg.append("g")
					.attr("class", "axis axis--y")
					.attr("transform", "translate(" + width + ",0)")
					.call(yAxis);
			});
		</script>
	</body>
</html>
