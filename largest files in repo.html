<!doctype html>
<html>

<head>
    <title>Repository files</title>
    <script src="js/Chart.bundle.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <style>
    #canvas-holder {
      width: 100%;
      text-align: center;
      float: left;
    }
    #chartjs-tooltip {
      opacity: 1;
      position: absolute;
      background: rgba(0, 0, 0, .7);
      color: white;
      border-radius: 3px;
      -webkit-transition: all .1s ease;
      transition: all .1s ease;
      pointer-events: none;
      -webkit-transform: translate(-50%, 0);
      transform: translate(-50%, 0);
      display: none;
    }

    .chartjs-tooltip-key {
      display: inline-block;
      width: 10px;
      height: 10px;
    }
      
    #data-table {
      border-collapse: collapse;
      float: left;
      margin: 10px 10px 0px 0px;
    }
      
    #data-table th, #data-table td {
      border: 1px solid black;
      padding: 5px;
    }
    </style>
</head>

<body>
    <h1>Largest files in repo</h1>
    <div style="display: inline-block">
    <table id="data-table">
      <tr><th>File</th><th>Size (KB)</th></tr>
    </taBle>
    <div id="canvas-holder" style="width: 300px;">
        <canvas id="viz" width="300" height="300" />
        <div id="chartjs-tooltip"></div>
    </div>
    </div>

    <script>
    Chart.defaults.global.tooltips.custom = function(tooltip) {

    	// Tooltip Element
      var tooltipEl = $('#chartjs-tooltip');

      if (!tooltipEl[0]) {
        $('body').append('<div id="chartjs-tooltip"></div>');
        tooltipEl = $('#chartjs-tooltip');
      }

      // Hide if no tooltip
      if (!tooltip.opacity) {
        tooltipEl.css({
          opacity: 0
        });
        $('.chartjs-wrap canvas')
          .each(function(index, el) {
            $(el).css('cursor', 'default');
          });
        return;
      }

      $(this._chart.canvas).css('cursor', 'pointer');

      // Set caret Position
      tooltipEl.removeClass('above below no-transform');
      if (tooltip.yAlign) {
        tooltipEl.addClass(tooltip.yAlign);
      } else {
        tooltipEl.addClass('no-transform');
      }
      
      // Set Text
      if (tooltip.body) {
        var innerHtml = [
          (tooltip.beforeTitle || []).join('\n'), (tooltip.title || []).join('\n'), (tooltip.afterTitle || []).join('\n'), (tooltip.beforeBody || []).join('\n'), (tooltip.body || []).join('\n'), (tooltip.afterBody || []).join('\n'), (tooltip.beforeFooter || [])
          .join('\n'), (tooltip.footer || []).join('\n'), (tooltip.afterFooter || []).join('\n')
        ];
        tooltipEl.html(innerHtml.join('\n'));
      }

      // Find Y Location on page
      var top = 0;
      if (tooltip.yAlign) {
        if (tooltip.yAlign == 'above') {
          top = tooltip.y - tooltip.caretHeight - tooltip.caretPadding;
        } else {
          top = tooltip.y + tooltip.caretHeight + tooltip.caretPadding;
        }
      }

      var position = $(this._chart.canvas)[0].getBoundingClientRect();
      
      // Display, position, and set styles for font
      tooltipEl.css({
        opacity: 1,
        width: tooltip.width ? (tooltip.width + 'px') : 'auto',
        left: position.left + tooltip.x + 'px',
        top: position.top + top + 'px',
        fontFamily: tooltip._fontFamily,
        fontSize: tooltip.fontSize,
        fontStyle: tooltip._fontStyle,
        padding: tooltip.yPadding + 'px ' + tooltip.xPadding + 'px',
      });
    };
    
    //get top5 size in json format
    var largestFiles = {
        "files":[
          {"path":"CS3201/lib/AutoTester_debug.lib", "size":"3504066" },
          {"path":"CS3201/lib/AutoTester_release.lib", "size":"1725994" },
          {"path":"CS3201/tools/cpplint.py", "size":"236262" },
          {"path":"CS3201/tests/SystemTesting/11-Queries.txt", "size":"227020" },
          {"path":"CS3201/tests/SystemTesting/Iteration", "size":"117562" },
        ]
    };

    var dataArr = new Array();
    var labelArr = new Array();
    
    for (var i = 0; i < largestFiles.files.length; i++) {
      dataArr[i] = largestFiles.files[i].size;
      var path = largestFiles.files[i].path;
      labelArr[i] = path.substr(path.indexOf("/") + 1);
      
      var row = document.createElement("tr");
      var label = document.createElement("td");
      label.appendChild(document.createTextNode(labelArr[i]));
      var size = document.createElement("td");
      size.appendChild(document.createTextNode(dataArr[i]));
      row.appendChild(label);
      row.appendChild(size);
      
      document.getElementById("data-table").appendChild(row);
    }
    
    var config = {
        type: 'pie',
        data: {
            datasets: [{
                data: dataArr,
                backgroundColor: [
                    "#F7464A",
                    "#46BFBD",
                    "#FDB45C",
                    "#949FB1",
                    "#4D5360",
                ],
            }],
            labels: labelArr
        },
        options: {
            responsive: true,
            legend: {
                display: false
            },
            tooltips: {
                enabled: true,
            }
        }
    };

    window.onload = function() {
        var ctx2 = document.getElementById("viz").getContext("2d");
        window.myPie = new Chart(ctx2, config);
    };
    </script>
</body>

</html>
